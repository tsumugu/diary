{"remainingRequest":"/Users/tsumugu/Documents/dev/vue/diary/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tsumugu/Documents/dev/vue/diary/src/views/RegistEventInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tsumugu/Documents/dev/vue/diary/src/views/RegistEventInfo.vue","mtime":1608394839908},{"path":"/Users/tsumugu/Documents/dev/vue/diary/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tsumugu/Documents/dev/vue/diary/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tsumugu/Documents/dev/vue/diary/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tsumugu/Documents/dev/vue/diary/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKaW1wb3J0IEltZ1VwbG9hZGVyIGZyb20gJy4uL2Fzc2V0cy9JbWdVcGxvYWRlci5qcycKaW1wb3J0IFBsYWNlc01hbmFnZXIgZnJvbSAnLi4vYXNzZXRzL1BsYWNlc01hbmFnZXIuanMnCmltcG9ydCBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZScKdmFyIGRhdGFiYXNlID0gZmlyZWJhc2UuZGF0YWJhc2UoKQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJyZWdpc3QiLAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNTaWduSW46IG51bGwsCiAgICAgIHVzZXJJbmZvOiBudWxsLAogICAgICBpc05vd0xvYWRpbmc6IHRydWUsCiAgICAgIElVOiBudWxsLAogICAgICBQTTogbnVsbCwKICAgICAgdXBsb2FkRmlsZXM6IG51bGwsCiAgICAgIHVwbG9hZFByb21pc2VMaXN0OiBbXSwKICAgICAgcHJldmlld0ltYWdlTGlzdDogW10sCiAgICAgIHN1Ym1pdEltYWdlVXJsTGlzdDogW10sCiAgICAgIHNlYXJjaFJlc3VsdFBsYWNlTGlzdDogW10sCiAgICAgIHVzZXJBZGRlZFBsYWNlTGlzdDogW10sCiAgICAgIG5lYXJieVBsYWNlTGlzdDogW10sCiAgICAgIHBsYWNlTGlzdDogW10sCiAgICAgIGZyaWVuZHNMaXN0OiBbXSwKICAgICAgd2hlcmVBZGQ6IG51bGwsCiAgICAgIHdob0FkZDogbnVsbCwKICAgICAgd2hlbjogbnVsbCwKICAgICAgd2hlcmU6IG51bGwsCiAgICAgIHdobzogbnVsbCwKICAgICAgd2hhdDogbnVsbAogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGlzU2lnbkluKGFmdGVyLCBiZWZvcmUpIHsKICAgICAgaWYgKGJlZm9yZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5pbml0TG9hZEZyb21GaXJlYmFzZSgpCiAgICAgIH0KICAgIH0sCiAgICB1c2VyQWRkZWRQbGFjZUxpc3QoKSB7CiAgICAgIHRoaXMub25DaGFuZ2VQbGFjZUxpc3QoKQogICAgfSwKICAgIHNlYXJjaFJlc3VsdFBsYWNlTGlzdCgpIHsKICAgICAgdGhpcy5vbkNoYW5nZVBsYWNlTGlzdCgpCiAgICB9LAogICAgbmVhcmJ5UGxhY2VMaXN0KCkgewogICAgICB0aGlzLm9uQ2hhbmdlUGxhY2VMaXN0KCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXRMb2FkRnJvbUZpcmViYXNlKCkgewogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigiZnJpZW5kcy8iK3RoaXMudXNlckluZm8udWlkKS5vbigndmFsdWUnLCAoc25hcHNob3QpID0+ewogICAgICAgIHZhciBmcmllZHNpbmZvID0gc25hcHNob3QudmFsKCkKICAgICAgICB0aGlzLmZyaWVuZHNMaXN0ID0gW10KICAgICAgICBPYmplY3Qua2V5cyhmcmllZHNpbmZvKS5mb3JFYWNoKGZpZCA9PiB7CiAgICAgICAgICB0aGlzLmZyaWVuZHNMaXN0LnB1c2goewogICAgICAgICAgICAiZnJpZW5kc19pZCI6IGZpZCwKICAgICAgICAgICAgIm5hbWUiOiBmcmllZHNpbmZvW2ZpZF0ubmFtZQogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9KQogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigicGxhY2VzLyIrdGhpcy51c2VySW5mby51aWQpLm9uKCd2YWx1ZScsIChzbmFwc2hvdCkgPT57CiAgICAgICAgdmFyIHBsYWNlc2luZm8gPSBzbmFwc2hvdC52YWwoKQogICAgICAgIHRoaXMudXNlckFkZGVkUGxhY2VMaXN0ID0gW10KICAgICAgICB0aGlzLnVzZXJBZGRlZFBsYWNlTGlzdC5wdXNoKHtuYW1lOiAiLS0gVXNlciBTYXZlZCBQbGFjZSAtLSIsIHBsYWNlX2lkOiBudWxsfSkKICAgICAgICBPYmplY3Qua2V5cyhwbGFjZXNpbmZvKS5mb3JFYWNoKHBpZCA9PiB7CiAgICAgICAgICB0aGlzLnVzZXJBZGRlZFBsYWNlTGlzdC5wdXNoKHsKICAgICAgICAgICAgInBsYWNlX2lkIjogcGlkLAogICAgICAgICAgICAibmFtZSI6IHBsYWNlc2luZm9bcGlkXS5uYW1lCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgb25GaWxlQ2hhbmdlKGUpIHsKICAgICAgY29uc3QgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgdGhpcy51cGxvYWRGaWxlcyA9IGZpbGVzCiAgICAgIEFycmF5LmZyb20oZmlsZXMpLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgdGhpcy5jcmVhdGVQcmV2aWV3SW1hZ2UoZmlsZSkKICAgICAgfSkKICAgICAgLy90aGlzLmNyZWF0ZVByZXZpZXdJbWFnZShmaWxlcykKICAgIH0sCiAgICBvbkNoYW5nZVBsYWNlTGlzdCgpIHsKICAgICAgdGhpcy5wbGFjZUxpc3QgPSBbXQogICAgICB2YXIgY29uY2F0MSA9IHRoaXMuc2VhcmNoUmVzdWx0UGxhY2VMaXN0LmNvbmNhdCh0aGlzLm5lYXJieVBsYWNlTGlzdCkKICAgICAgdGhpcy5wbGFjZUxpc3QgPSB0aGlzLnVzZXJBZGRlZFBsYWNlTGlzdC5jb25jYXQoY29uY2F0MSkKICAgIH0sCiAgICBjcmVhdGVQcmV2aWV3SW1hZ2UoZmlsZSkgewogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgICAgICB0aGlzLnByZXZpZXdJbWFnZUxpc3QucHVzaChlLnRhcmdldC5yZXN1bHQpCiAgICAgIH0KICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgIH0sCiAgICB1cGxvYWRJbWcoZmlsZSkgewogICAgICByZXR1cm4gdGhpcy5JVS51cGxvYWQoZmlsZSkKICAgIH0sCiAgICB1bmlxdWVTdHIoKSB7CiAgICAgIHZhciBzdHJvbmcgPSAxMDAwCiAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKS50b1N0cmluZygxNikgICsgTWF0aC5mbG9vcihzdHJvbmcqTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMTYpCiAgICB9LAogICAgb25BZGRXaGVyZUJ1dHRvbigpIHsKICAgICAgLy90aGlzLndoZXJlQWRk44Gn5qSc57Si44GX44Gm44G/44KLCiAgICAgIHRoaXMuUE0uc2VhcmNocGxhY2VzYnluYW1lKHRoaXMud2hlcmVBZGQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgLy8gc2VsZWN044KS5pu05pawCiAgICAgICAgdGhpcy5zZWFyY2hSZXN1bHRQbGFjZUxpc3QgPSBbXQogICAgICAgIHRoaXMuc2VhcmNoUmVzdWx0UGxhY2VMaXN0LnB1c2goe25hbWU6ICItLSBOZXcgVXNlciBBZGQgLS0iLCBwbGFjZV9pZDogbnVsbH0pCiAgICAgICAgdGhpcy5zZWFyY2hSZXN1bHRQbGFjZUxpc3QucHVzaCh7bmFtZTogdGhpcy53aGVyZUFkZCwgcGxhY2VfaWQ6ICJwaWRfIit0aGlzLnVuaXF1ZVN0cigpfSkKICAgICAgICB0aGlzLnNlYXJjaFJlc3VsdFBsYWNlTGlzdC5wdXNoKHtuYW1lOiAiLS0gU2VhcmNoIFJlc3VsdCAtLSIsIHBsYWNlX2lkOiBudWxsfSkKICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goKHBsYWNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNlYXJjaFJlc3VsdFBsYWNlTGlzdC5wdXNoKHBsYWNlKQogICAgICAgIH0pCiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCJQbGFjZXMgTWFuYWdlciBFcnJvciIsIGVycm9yKQogICAgICB9KQogICAgfSwKICAgIG9uQWRkV2hvQnV0dG9uKCkgewogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigiZnJpZW5kcy8iK3RoaXMudXNlckluZm8udWlkKS5wdXNoKHsibmFtZSI6dGhpcy53aG9BZGR9KS50aGVuKCgpID0+IHsKICAgICAgICBhbGVydCgi44OV44Os44Oz44OJ44KS6L+95Yqg44GX44G+44GX44Gf77yBIikKICAgICAgfSkKICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgIC8vb25FcnJvcgogICAgICAgIGNvbnNvbGUubG9nKCJGaXJlYmFzZSBFcnJvciIsIGVycm9yKQogICAgICB9KQogICAgfSwKICAgIG9uU3VibWl0KCkgewogICAgICAvLyBzdWJtaXTlh6bnkIYKICAgICAgLy8gMS4g55S75YOP44KS44Ki44OD44OX44Ot44O844OJ44GZ44KLCiAgICAgIGlmICh0aGlzLnVwbG9hZEZpbGVzICE9IG51bGwpIHsKICAgICAgICBBcnJheS5mcm9tKHRoaXMudXBsb2FkRmlsZXMpLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgICB0aGlzLnVwbG9hZFByb21pc2VMaXN0LnB1c2godGhpcy51cGxvYWRJbWcoZmlsZSkpCiAgICAgICAgfSkKICAgICAgfQogICAgICAvLyAyLiDjgqLjg4Pjg5fjg63jg7zjg4njgYzlrozkuobjgZfjgZ/jgonjgZnjgbnjgabjga7mg4XloLHjgpLlkIjjgo/jgZvjgaZSZWFsdGltZURC44Grc2V0CiAgICAgIFByb21pc2UuYWxsKHRoaXMudXBsb2FkUHJvbWlzZUxpc3QpLnRoZW4oKEltYWdlVXJscykgPT4gewogICAgICAgIC8vQVBJ44GL44KJ5biw44Gj44Gm44GN44GfSlNPTuOCkuODkeODvOOCueOBl+OBpuOAgVVSTOOCkumFjeWIl+OBq+OBvuOBqOOCgeOCiwogICAgICAgIEltYWdlVXJscy5mb3JFYWNoKChqc29uKSA9PiB7CiAgICAgICAgICB0aGlzLnN1Ym1pdEltYWdlVXJsTGlzdC5wdXNoKGpzb24uZGF0YS51cmwpCiAgICAgICAgfSkKICAgICAgICB2YXIgVXNlclBvc3RJbmZvT2JqID0gewogICAgICAgICAgd2hlbjogdGhpcy53aGVuLAogICAgICAgICAgd2hlcmU6IHRoaXMud2hlcmUsCiAgICAgICAgICB3aG86IHRoaXMud2hvLAogICAgICAgICAgd2hhdDogdGhpcy53aGF0LAogICAgICAgICAgaW1nVXJsczogdGhpcy5zdWJtaXRJbWFnZVVybExpc3QKICAgICAgICB9CiAgICAgICAgLy/lv4XpoIjpoIXnm67jga7jg4Hjgqfjg4Pjgq8KICAgICAgICBpZiAoVXNlclBvc3RJbmZvT2JqLndoZW4gIT0gbnVsbCAmJiBVc2VyUG9zdEluZm9PYmoud2hlcmUgIT0gbnVsbCAmJiBVc2VyUG9zdEluZm9PYmoud2hhdCAhPSBudWxsKSB7CiAgICAgICAgICBpZiAoVXNlclBvc3RJbmZvT2JqLndoZW4ucmVwbGFjZSgvXHMrL2csJycpLmxlbmd0aCA+IDAgJiYgVXNlclBvc3RJbmZvT2JqLndoZXJlLnJlcGxhY2UoL1xzKy9nLCcnKS5sZW5ndGggPiAwICYmIFVzZXJQb3N0SW5mb09iai53aGF0LnJlcGxhY2UoL1xzKy9nLCcnKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vRELjgavkv53lrZgKICAgICAgICAgICAgdGhpcy5zZXRGaXJlYmFzZVJlYWx0aW1lREIoVXNlclBvc3RJbmZvT2JqKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxlcnQoIndoZW4sIHdoZXJlLCB3aGF044Gv5b+F6aCI6aCF55uu44Gn44GZIikKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWxlcnQoIndoZW4sIHdoZXJlLCB3aGF044Gv5b+F6aCI6aCF55uu44Gn44GZIikKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgc2V0RmlyZWJhc2VSZWFsdGltZURCKE9iaikgewogICAgICAvLyBwbGFjZV9pZOOBi+OCieWQjeWJjeOCkuWPluW+lwogICAgICB2YXIgcGxhY2VfbmFtZSA9IG51bGwKICAgICAgT2JqZWN0LmtleXModGhpcy5wbGFjZUxpc3QpLmZvckVhY2goayA9PiB7CiAgICAgICAgaWYgKHRoaXMucGxhY2VMaXN0W2tdLnBsYWNlX2lkID09IE9iai53aGVyZSkgewogICAgICAgICAgcGxhY2VfbmFtZSA9IHRoaXMucGxhY2VMaXN0W2tdLm5hbWUKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSkKICAgICAgLy8gcGxhY2VfaWTjgajlkI3liY3jgpLkv53lrZgo5ZCM5ZCN44Gn5LiK5pu444GN44GV44KM44KL44Gu44Gn5a2Y5Zyo56K66KqN44Gv44GX44Gq44GEKQogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigicGxhY2VzLyIrdGhpcy51c2VySW5mby51aWQrIi8iK09iai53aGVyZSkuc2V0KHtuYW1lOiBwbGFjZV9uYW1lfSkudGhlbigoKSA9PiB7CiAgICAgICAgLy8KICAgICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigicG9zdHMvIit0aGlzLnVzZXJJbmZvLnVpZCkucHVzaChPYmopLnRoZW4oKCkgPT4gewogICAgICAgICAgYWxlcnQoIuaKleeov+OBl+OBvuOBl+OBn++8gSIpCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAvL29uRXJyb3IKICAgICAgICAgIGNvbnNvbGUubG9nKCJGaXJlYmFzZSBFcnJvciIsIGVycm9yKQogICAgICAgICAgYWxlcnQoIuaKleeov+OBq+WkseaVl+OBl+OBvuOBl+OBnyIpCiAgICAgICAgfSkKICAgICAgICAvLwogICAgICB9KQogICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coIkZpcmViYXNlIEVycm9yIiwgZXJyb3IpCiAgICAgIH0pCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgY29uc3QgX3RoaXMgPSB0aGlzCgogICAgZmlyZWJhc2UuYXV0aCgpLm9uQXV0aFN0YXRlQ2hhbmdlZCh1c2VyID0+IHsKICAgICAgX3RoaXMuaXNTaWduSW4gPSAodXNlciAhPSBudWxsKQogICAgICBfdGhpcy51c2VySW5mbyA9IHVzZXIKICAgICAgX3RoaXMuaXNOb3dMb2FkaW5nID0gZmFsc2UKICAgIH0pCgogICAgdGhpcy5JVSA9IG5ldyBJbWdVcGxvYWRlcihheGlvcykKICAgIHRoaXMuUE0gPSBuZXcgUGxhY2VzTWFuYWdlcihheGlvcykKCiAgICAvLyDnj77lnKjlnLDjgpLlj5blvpcKICAgIGlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHsKICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbigocG9zaXRpb24pID0+IHsgCiAgICAgICAgdmFyIGRhdGEgPSBwb3NpdGlvbi5jb29yZHMKCSAgICAgIHZhciBsYXQgPSBkYXRhLmxhdGl0dWRlCgkgICAgICB2YXIgbG9uID0gZGF0YS5sb25naXR1ZGUKICAgICAgICAvLyAiLTMzLjg2NzA1MjIiLCAiMTUxLjE5NTczNjIiCiAgICAgICAgLy8g5Y+W5b6X44GX44Gf54++5Zyo5Zyw44KS44KC44Go44Gr6L+R6L6644Gu44Op44Oz44OJ44Oe44O844Kv44KS5Y+W5b6XCiAgICAgICAgdGhpcy5QTS5zZWFyY2huZWFyYnlwbGFjZXNieWxhdGxvbihsYXQsIGxvbikudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIC8vIHNlbGVjdOOCkuabtOaWsAogICAgICAgICAgdGhpcy5uZWFyYnlQbGFjZUxpc3QgPSBbXQogICAgICAgICAgdGhpcy5uZWFyYnlQbGFjZUxpc3QucHVzaCh7bmFtZTogIi0tIEdQUyBSZXN1bHQgLS0iLCBwbGFjZV9pZDogbnVsbH0pCiAgICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goKHBsYWNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMubmVhcmJ5UGxhY2VMaXN0LnB1c2gocGxhY2UpCiAgICAgICAgICB9KQogICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgY29uc29sZS5sb2coIlBsYWNlcyBNYW5hZ2VyIEVycm9yIiwgZXJyb3IpCiAgICAgICAgfSkKICAgICAgfSwgKGVycm9yKSA9PiB7IGNvbnNvbGUubG9nKCJHZW9Mb2NhdGlvbiBBUEkgRXJyb3IiLCBlcnJvcikgfSkKICAgIH0gZWxzZSB7CiAgICAgIC8vIOerr+acq+OBjEdlb0xvY2F0aW9uIEFQSeOBq+mdnuWvvuW/nOOBoOOBo+OBn+WgtOWQiAogICAgICAvLyDmnIDov5Hjga7loLTmiYDjgpLpganlvZPjgavooajnpLoKICAgIH0KCiAgfQp9Cg=="},{"version":3,"sources":["RegistEventInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"RegistEventInfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"regist\">\n    <div class=\"regist__loading\" v-if=\"isNowLoading\"><!-- Loading --></div>\n    <div class=\"regist__body\" v-else>\n      <div class=\"regist__body__signined\" v-if=\"isSignIn\">\n        <!-- form -->\n        <div><input type=\"datetime-local\" placeholder=\"日付\" v-model=\"when\" /></div>\n        <div><select v-model=\"where\"><option disabled value=\"\">場所</option><option v-for=\"(val, key) in placeList\" v-bind:value=\"val.place_id\" v-bind:disabled=\"val.place_id==null\">{{val.name}}</option></select><div><input type=\"text\" v-model=\"whereAdd\" /><button v-on:click=\"onAddWhereButton\">+</button></div></div>\n        <div><select v-model=\"who\"><option disabled value=\"\">誰と行ったか</option><option v-for=\"(val, key) in friendsList\" v-bind:value=\"val.friends_id\">{{val.name}}</option></select><div><input type=\"text\" v-model=\"whoAdd\" /><button v-on:click=\"onAddWhoButton\">+</button></div></div>\n        <div><textarea placeholder=\"したこと\" v-model=\"what\" /></div>\n        <div class=\"imgPreview\">\n          <img v-bind:src=\"src\" v-for=\"(src, key) in previewImageList\" :key=\"key\">\n        </div>\n        <div><input type=\"file\" @change=\"onFileChange\" accept=\"image/*\" multiple /></div>\n        <div><button v-on:click=\"onSubmit\">投稿</button></div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport ImgUploader from '../assets/ImgUploader.js'\nimport PlacesManager from '../assets/PlacesManager.js'\nimport firebase from 'firebase'\nvar database = firebase.database()\n\nexport default {\n  name: \"regist\",\n  data () {\n    return {\n      isSignIn: null,\n      userInfo: null,\n      isNowLoading: true,\n      IU: null,\n      PM: null,\n      uploadFiles: null,\n      uploadPromiseList: [],\n      previewImageList: [],\n      submitImageUrlList: [],\n      searchResultPlaceList: [],\n      userAddedPlaceList: [],\n      nearbyPlaceList: [],\n      placeList: [],\n      friendsList: [],\n      whereAdd: null,\n      whoAdd: null,\n      when: null,\n      where: null,\n      who: null,\n      what: null\n    }\n  },\n  watch: {\n    isSignIn(after, before) {\n      if (before == null) {\n        this.initLoadFromFirebase()\n      }\n    },\n    userAddedPlaceList() {\n      this.onChangePlaceList()\n    },\n    searchResultPlaceList() {\n      this.onChangePlaceList()\n    },\n    nearbyPlaceList() {\n      this.onChangePlaceList()\n    }\n  },\n  methods: {\n    initLoadFromFirebase() {\n      firebase.database().ref(\"friends/\"+this.userInfo.uid).on('value', (snapshot) =>{\n        var friedsinfo = snapshot.val()\n        this.friendsList = []\n        Object.keys(friedsinfo).forEach(fid => {\n          this.friendsList.push({\n            \"friends_id\": fid,\n            \"name\": friedsinfo[fid].name\n          })\n        })\n      })\n      firebase.database().ref(\"places/\"+this.userInfo.uid).on('value', (snapshot) =>{\n        var placesinfo = snapshot.val()\n        this.userAddedPlaceList = []\n        this.userAddedPlaceList.push({name: \"-- User Saved Place --\", place_id: null})\n        Object.keys(placesinfo).forEach(pid => {\n          this.userAddedPlaceList.push({\n            \"place_id\": pid,\n            \"name\": placesinfo[pid].name\n          })\n        })\n      })\n    },\n    onFileChange(e) {\n      const files = e.target.files || e.dataTransfer.files;\n      this.uploadFiles = files\n      Array.from(files).forEach(file => {\n        this.createPreviewImage(file)\n      })\n      //this.createPreviewImage(files)\n    },\n    onChangePlaceList() {\n      this.placeList = []\n      var concat1 = this.searchResultPlaceList.concat(this.nearbyPlaceList)\n      this.placeList = this.userAddedPlaceList.concat(concat1)\n    },\n    createPreviewImage(file) {\n      const reader = new FileReader()\n      reader.onload = e => {\n        this.previewImageList.push(e.target.result)\n      }\n      reader.readAsDataURL(file)\n    },\n    uploadImg(file) {\n      return this.IU.upload(file)\n    },\n    uniqueStr() {\n      var strong = 1000\n      return new Date().getTime().toString(16)  + Math.floor(strong*Math.random()).toString(16)\n    },\n    onAddWhereButton() {\n      //this.whereAddで検索してみる\n      this.PM.searchplacesbyname(this.whereAdd).then((response) => {\n        // selectを更新\n        this.searchResultPlaceList = []\n        this.searchResultPlaceList.push({name: \"-- New User Add --\", place_id: null})\n        this.searchResultPlaceList.push({name: this.whereAdd, place_id: \"pid_\"+this.uniqueStr()})\n        this.searchResultPlaceList.push({name: \"-- Search Result --\", place_id: null})\n        response.data.forEach((place) => {\n          this.searchResultPlaceList.push(place)\n        })\n      }).catch((error) => {\n        console.log(\"Places Manager Error\", error)\n      })\n    },\n    onAddWhoButton() {\n      firebase.database().ref(\"friends/\"+this.userInfo.uid).push({\"name\":this.whoAdd}).then(() => {\n        alert(\"フレンドを追加しました！\")\n      })\n      .catch((error) => {\n        //onError\n        console.log(\"Firebase Error\", error)\n      })\n    },\n    onSubmit() {\n      // submit処理\n      // 1. 画像をアップロードする\n      if (this.uploadFiles != null) {\n        Array.from(this.uploadFiles).forEach(file => {\n          this.uploadPromiseList.push(this.uploadImg(file))\n        })\n      }\n      // 2. アップロードが完了したらすべての情報を合わせてRealtimeDBにset\n      Promise.all(this.uploadPromiseList).then((ImageUrls) => {\n        //APIから帰ってきたJSONをパースして、URLを配列にまとめる\n        ImageUrls.forEach((json) => {\n          this.submitImageUrlList.push(json.data.url)\n        })\n        var UserPostInfoObj = {\n          when: this.when,\n          where: this.where,\n          who: this.who,\n          what: this.what,\n          imgUrls: this.submitImageUrlList\n        }\n        //必須項目のチェック\n        if (UserPostInfoObj.when != null && UserPostInfoObj.where != null && UserPostInfoObj.what != null) {\n          if (UserPostInfoObj.when.replace(/\\s+/g,'').length > 0 && UserPostInfoObj.where.replace(/\\s+/g,'').length > 0 && UserPostInfoObj.what.replace(/\\s+/g,'').length > 0) {\n            //DBに保存\n            this.setFirebaseRealtimeDB(UserPostInfoObj)\n          } else {\n            alert(\"when, where, whatは必須項目です\")\n          }\n        } else {\n          alert(\"when, where, whatは必須項目です\")\n        }\n      })\n    },\n    setFirebaseRealtimeDB(Obj) {\n      // place_idから名前を取得\n      var place_name = null\n      Object.keys(this.placeList).forEach(k => {\n        if (this.placeList[k].place_id == Obj.where) {\n          place_name = this.placeList[k].name\n          return true;\n        }\n      })\n      // place_idと名前を保存(同名で上書きされるので存在確認はしない)\n      firebase.database().ref(\"places/\"+this.userInfo.uid+\"/\"+Obj.where).set({name: place_name}).then(() => {\n        //\n        firebase.database().ref(\"posts/\"+this.userInfo.uid).push(Obj).then(() => {\n          alert(\"投稿しました！\")\n        })\n        .catch((error) => {\n          //onError\n          console.log(\"Firebase Error\", error)\n          alert(\"投稿に失敗しました\")\n        })\n        //\n      })\n      .catch((error) => {\n        console.log(\"Firebase Error\", error)\n      })\n    }\n  },\n  mounted() {\n    const _this = this\n\n    firebase.auth().onAuthStateChanged(user => {\n      _this.isSignIn = (user != null)\n      _this.userInfo = user\n      _this.isNowLoading = false\n    })\n\n    this.IU = new ImgUploader(axios)\n    this.PM = new PlacesManager(axios)\n\n    // 現在地を取得\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((position) => { \n        var data = position.coords\n\t      var lat = data.latitude\n\t      var lon = data.longitude\n        // \"-33.8670522\", \"151.1957362\"\n        // 取得した現在地をもとに近辺のランドマークを取得\n        this.PM.searchnearbyplacesbylatlon(lat, lon).then((response) => {\n          // selectを更新\n          this.nearbyPlaceList = []\n          this.nearbyPlaceList.push({name: \"-- GPS Result --\", place_id: null})\n          response.data.forEach((place) => {\n            this.nearbyPlaceList.push(place)\n          })\n        }).catch((error) => {\n          console.log(\"Places Manager Error\", error)\n        })\n      }, (error) => { console.log(\"GeoLocation API Error\", error) })\n    } else {\n      // 端末がGeoLocation APIに非対応だった場合\n      // 最近の場所を適当に表示\n    }\n\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.regist {\n  width: 100%;\n  height: 100%;\n  &__loading {\n    width: 100%;\n    height: 100%;\n  }\n  &__body {\n    width: 100%;\n    height: 100%;\n    &__signined {\n      width: 100%;\n      height: 100%;\n    }\n  }\n}\n.imgPreview > img {\n  width: 100px;\n}\n</style>"]}]}